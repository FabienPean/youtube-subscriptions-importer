<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <meta charset="utf-8">
    <title></title>
</head>

<body>
    <script>
        var GoogleAuth;
        //What part of the youtube API do we need scope for?
        var SCOPE = 'https://www.googleapis.com/auth/youtube';

        function handleClientLoad() {
            // Load the API's client and auth2 modules.
            // Call the initClient function after the modules load.
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            // Retrieve the discovery document for version 3 of YouTube Data API.
            // In practice, your app can retrieve one or more discovery documents.
            var discoveryUrl = 'https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest';

            // Initialize the gapi.client object, which app uses to make API requests.
            // Get API key and client ID from API Console.
            // 'scope' field specifies space-delimited list of access scopes.
            gapi.client.init({
                'apiKey': 'AIzaSyDYBDUTV4sutxPxq3j0-FpxeajCvMJDJSU',
                'discoveryDocs': [discoveryUrl],
                'clientId': '1041512274445-upcpmoa8f37d5eping3t3cm7gl79ic9p.apps.googleusercontent.com',
                'scope': SCOPE
            }).then(function() {
                GoogleAuth = gapi.auth2.getAuthInstance();

                // Listen for sign-in state changes.
                GoogleAuth.isSignedIn.listen(updateSigninStatus);

                // Handle initial sign-in state. (Determine if user is already signed in.)
                var user = GoogleAuth.currentUser.get();
                setSigninStatus();

                // Call handleAuthClick function when user clicks on
                //      "Sign In/Authorize" button.
                $('#sign-in-or-out-button').click(function() {
                    handleAuthClick();
                });
                $('#revoke-access-button').click(function() {
                    revokeAccess();
                    console.log("pressed button");
                });
                $('#add-subscription').click(function() {
                    addSubscription($('#subscription-id').val());
                    console.log($('#subscription-id').val());
                });
            });
        }

        function handleAuthClick() {
            if (GoogleAuth.isSignedIn.get()) {
                // User is authorized and has clicked 'Sign out' button.
                GoogleAuth.signOut();
            } else {
                // User is not signed in. Start Google auth flow.
                GoogleAuth.signIn();
            }
        }

        function revokeAccess() {
            GoogleAuth.disconnect();
        }

        function setSigninStatus(isSignedIn) {
            var user = GoogleAuth.currentUser.get();
            var isAuthorized = user.hasGrantedScopes(SCOPE);
            if (isAuthorized) {
                $('#sign-in-or-out-button').html('Sign out');
                $('#revoke-access-button').css('display', 'inline-block');
                $('#auth-status').html('You are currently signed in and have granted ' +
                    'access to this app.');
                $('#add-subscription').html('Add Subscription')
            } else {
                $('#add-subscription').html('error')
                $('#sign-in-or-out-button').html('Sign In/Authorize');
                $('#revoke-access-button').css('display', 'none');
                $('#auth-status').html('You have not authorized this app or you are ' +
                    'signed out.');
            }
        }

        function updateSigninStatus(isSignedIn) {
            setSigninStatus();
        }

        // Subscribes the authorized user to the channel specified
        function addSubscription(channelSub) {
            var resource = {
                part: 'id,snippet',
                snippet: {
                    resourceId: {
                        kind: 'youtube#channel',
                        channelId: channelSub
                    }
                }
            };

            var request = gapi.client.youtube.subscriptions.insert(resource);
            request.execute(function(response) {
                var result = response.result;
                if (result) {
                    console.log("subscription completed");
                }
            });
        }


        $.get("subscription_manager.xml", function(data) {
            //var xmlDoc = data.responseXML;
            var regex = /(UC)[A-Za-z0-9\-_]+/g;
            var x = $(data);
            var outline = x.find("outline[xmlUrl]")
            $(outline).each(function(){
              $(this).attr("xmlUrl");
              var url = $(this).attr("xmlUrl")+"";
              console.log(url.match(regex)[0]);
              //console.log(myRe.exec(url));
            })
            //console.log(outline);
            /*console.log(x);
            x = data.documentElement.$("<outline>");
            console.log(x);
            var txt = "";
            for (i = 0; i < x.length; i++) {
                if (x[i].nodeType == 1) {
                    txt += x[i].nodeName + "<br>";
                }
            }
            //document.getElementById("demo").innerHTML = txt;
            */
            //$("#demo").html(txt);
            //alert(data);
        });

    </script>

    <button id="sign-in-or-out-button" style="margin-left: 25px">Sign In/Authorize</button>
    <button id="revoke-access-button" style="display: none; margin-left: 25px">Revoke access</button>


    <div id="auth-status" style="display: inline; padding-left: 25px"></div>
    <hr>


    <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <button id="add-subscription" style="margin-left: 25px">Add Subscription</button>
    <input id="subscription-id" type="text" name="" value="">
    <br>
    <p id="demo">example text</p>






</body>

</html>
